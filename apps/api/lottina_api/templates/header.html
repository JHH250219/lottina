{# templates/header.html #}
<header class="fixed top-0 inset-x-0 z-50">
  <div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
    <div class="mt-4 flex items-center gap-4 rounded-2xl bg-lottina-accent px-4 py-3 shadow-xl border border-lottina-primary/10">

      <!-- Logo -->
      <a href="{{ url_for('index') }}" class="inline-flex items-center gap-2 text-lottina-primary" aria-label="Startseite">
        <img src="{{ url_for('static', filename='img/lottina_logo_weiÃŸ.png') }}" alt="lottina Logo" class="h-10 w-auto filter drop-shadow" style="mix-blend-mode:multiply;">
        <span class="text-lg font-lottina tracking-wide"></span>
      </a>

      <!-- Suche -->
      {% if request.path != '/' %}
      <form action="{{ url_for('suchergebnisse') }}" method="get"
            class="hidden md:flex flex-1 mx-2">
        <label for="header-q" class="sr-only">Suche</label>
        <input id="header-q" type="text" name="q" value="{{ query if query else '' }}"
               placeholder="Suche nach Ort oder Begriff"
               class="w-full px-4 py-2 rounded-xl border border-lottina-primary/20 bg-white text-lottina-primary placeholder:text-lottina-primary/40 focus:outline-none focus:ring-2 focus:ring-lottina-accent/60">
      </form>
      {% else %}
      <div class="flex-1"></div>
      {% endif %}

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center gap-4 text-sm font-semibold text-lottina-primary">
        <a href="{{ url_for('results') }}" class="hover:text-white transition">Erlebnisse</a>
        <a href="{{ url_for('sichtbar_werden')}}" class="hover:text-white transition">Sichtbar werden</a>
        <a href="{{ url_for('ueber_uns') }}" class="hover:text-white transition">Ãœber uns</a>
        {% if current_user.is_authenticated %}
          {% if current_user.is_admin %}
            <a href="{{ url_for('dashboard') }}" class="hover:text-white transition">Admin</a>
          {% endif %}
          <a href="{{ url_for('profil') }}" class="hover:text-white transition">Profil</a>
          <a href="{{ url_for('logout') }}" class="hover:text-white transition">Logout</a>
        {% else %}
          <a href="{{ url_for('login') }}" class="hover:text-white transition">Login</a>
        {% endif %}
      </nav>

      <div class="hidden md:flex items-center gap-3">
        <a href="{{ url_for('event_erstellen') }}"
           class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-white text-lottina-primary font-semibold shadow hover:translate-y-[-1px] transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5h12M9 3v2m3.75 3.75-8.5 8.5a2.12 2.12 0 0 0-.62 1.5V21h2.25a2.12 2.12 0 0 0 1.5-.62l8.5-8.5m-3.13-3.13 2.12-2.12a1.5 1.5 0 0 1 2.12 2.12l-2.12 2.12m-2.12-2.12 2.12 2.12"/>
          </svg>
          Erlebnis erstellen
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button id="menuToggle"
              class="flex md:hidden items-center justify-center rounded-xl border border-lottina-primary/20 bg-white px-3 py-2 text-lottina-primary text-lg shadow hover:bg-white focus:outline-none"
              aria-label="MenÃ¼ Ã¶ffnen oder schlieÃŸen"
              aria-expanded="false">
        â˜°
      </button>
    </div>
  </div>

  <!-- Mobile Overlay -->
  <div id="menuOverlay" class="fixed inset-0 z-[60] hidden">
    <div class="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>
    <aside id="menuPanel"
           class="absolute top-6 right-6 w-72 max-w-[80vw] rounded-3xl border border-lottina-primary/15 bg-lottina-accent text-lottina-primary shadow-2xl transform translate-x-full transition-transform duration-300 ease-out flex flex-col gap-4 p-6">
      <nav class="space-y-3 text-sm font-semibold">
        <a href="{{ url_for('results') }}" class="mobile-link">Events entdecken</a>
        <a href="{{ url_for('event_erstellen') }}" class="mobile-link">Event erstellen</a>
        <a href="/so-funktionierts" class="mobile-link">So funktioniertâ€™s</a>
        <a href="{{ url_for('ueber_uns') }}" class="mobile-link">Ãœber uns</a>
        <a href="/faq" id="menuFaqLink" class="mobile-link">FAQ</a>
      </nav>
      <div class="mt-2 flex items-center gap-4 text-xs text-lottina-primary/70">
        <span>Sprache:</span>
        <a href="{{ request.path }}?lang=de" class="hover:text-lottina-primary transition">ðŸ‡©ðŸ‡ª DE</a>
        <a href="{{ request.path }}?lang=en" class="hover:text-lottina-primary transition">ðŸ‡¬ðŸ‡§ EN</a>
      </div>
      <div class="border-t border-lottina-primary/20 pt-4 text-sm text-lottina-primary/80 space-y-1">
        {% if current_user.is_authenticated %}
          <span>Angemeldet als {{ current_user.username }}</span>
          <a href="{{ url_for('logout') }}" class="mobile-link">Logout</a>
        {% else %}
          <a href="{{ url_for('login') }}" class="mobile-link">Login</a>
        {% endif %}
      </div>
    </aside>
  </div>
</header>

<style>
  .mobile-link {
    display:flex;
    align-items:center;
    gap:.6rem;
    padding:.65rem .9rem;
    border-radius:1rem;
    background:rgba(255,255,255,0.08);
    color:inherit;
    transition:background .2s ease, transform .2s ease;
  }
  .mobile-link::before {
    content:"â€º";
    font-weight:bold;
    opacity:.6;
  }
  .mobile-link:hover {
    background:rgba(255,255,255,0.16);
    transform:translateX(4px);
  }
  .sr-only {
    position:absolute;
    width:1px;
    height:1px;
    padding:0;
    margin:-1px;
    overflow:hidden;
    clip:rect(0,0,0,0);
    white-space:nowrap;
    border:0;
  }
</style>

<script>
  const toggle  = document.getElementById("menuToggle");
  const overlay = document.getElementById("menuOverlay");
  const panel   = document.getElementById("menuPanel");
  const faqLink = document.getElementById("menuFaqLink");

  function openMenu() {
    overlay.classList.remove("hidden");
    requestAnimationFrame(() => panel.classList.remove("translate-x-full"));
    toggle?.setAttribute("aria-expanded", "true");
  }
  function closeMenu() {
    panel.classList.add("translate-x-full");
    setTimeout(() => overlay.classList.add("hidden"), 280);
    toggle?.setAttribute("aria-expanded", "false");
  }
  function toggleMenu() {
    const isOpen = !overlay.classList.contains("hidden");
    isOpen ? closeMenu() : openMenu();
  }

  toggle?.addEventListener("click", toggleMenu);
  overlay?.addEventListener("click", (e) => {
    if (!panel.contains(e.target)) closeMenu();
  });

  faqLink?.addEventListener("click", (e) => {
    e.preventDefault();
    closeMenu();
    const target = document.getElementById("faq");
    if (target) setTimeout(() => target.scrollIntoView({ behavior: "smooth" }), 350);
  });
</script>
